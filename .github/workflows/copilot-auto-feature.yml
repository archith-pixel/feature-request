name: Feature Request Automation

on:
  issues:
    types: [opened]

jobs:
  copilot-task:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Set up GitHub CLI and Copilot CLI
      run: |
        gh extension install github/gh-copilot
        echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token

    - name: Get Issue Description and Run Copilot
      run: |
        ISSUE_BODY=$(gh issue view ${{ github.event.issue.number }} --json body -q ".body")
        echo "Generating code with Copilot for request: $ISSUE_BODY"
        gh copilot suggest --chat "$ISSUE_BODY" > copilot-output.txt

    - name: Create new file with Copilot response
      run: |
        FILE_NAME="feature_${{ github.event.issue.number }}.html"
        echo "<!-- Generated by Copilot -->" > $FILE_NAME
        cat copilot-output.txt >> $FILE_NAME
        git config user.name github-actions
        git config user.email github-actions@github.com
        git add $FILE_NAME
        git commit -m "ðŸ¤– Add feature from issue #${{ github.event.issue.number }}"
        git push

        git commit -m "Processed one request"
        git push

